<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GravitySwap-The game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: 'Courier New', Courier, monospace;
      color: #00ff00;
    }
    canvas {
      display: block;
    }
    @font-face {
      font-family: 'PressStart2P';
      src: url('https://fonts.gstatic.com/s/pressstart2p/v12/e3t4euO8T-267oIAQAu6jDQyKFF2zw.woff2') format('woff2');
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>
<audio id="bgMusic" src="game.mp3" loop autoplay muted></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// Game Assets
const birdImg = new Image();
birdImg.src = "pixel_bird-removebg-preview.png";

const birdWidth = 90;
const birdHeight = 90;

let bird = {
  x: canvas.width / 4,
  y: canvas.height / 2,
  vy: 0
};

let gravity = 0.4;
let gravityDirection = 1;
const flapPower = 11;

let pipes = [];
const pipeWidth = 60;
const gapHeight = 375;
const pipeSpeed = 3.7;
const pipeFrequency = 2000;

let gameOver = false;

let bg = new Image();
bg.src = "space.jpg";

let stars = Array.from({ length: 50 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  radius: Math.random() * 2
}));

let score = 0;

// Countdown State
let countdown = null;
let countdownScale = 1;
let countdownOpacity = 1;
let gravityFlipInterval = 6000;

function triggerGravityFlipCountdown() {
  if (gameOver) return;

  const sequence = ["3", "2", "1", "GRAVITY SWITCH!"];
  let i = 0;

  function showNext() {
    if (gameOver) {
      countdown = null;
      return;
    }

    if (i >= sequence.length) {
      countdown = null;
      return;
    }

    countdown = sequence[i];
    countdownScale = 2;
    countdownOpacity = 1;

    // Flip gravity right after "1"
    if (sequence[i] === "1") {
      gravityDirection *= -1;
      gravity = 0.4 * gravityDirection;
    }

    i++;
    setTimeout(showNext, 1000);
  }

  showNext();
}

setInterval(triggerGravityFlipCountdown, gravityFlipInterval);

// Controls
window.addEventListener("keydown", (e) => {
  if (!gameOver) {
    if (gravityDirection === 1 && e.code === "ArrowUp") {
      bird.vy = -flapPower;
    } else if (gravityDirection === -1 && e.code === "ArrowDown") {
      bird.vy = flapPower;
    }
  } else if (e.code === "Space") {
    restartGame();
  }
});

// Pipes
function addPipe() {
  let topHeight = Math.random() * (canvas.height - gapHeight - 150) + 50;
  pipes.push({
    x: canvas.width,
    topHeight: topHeight,
    scored: false
  });
}
setInterval(() => {
  if (!gameOver) addPipe();
}, pipeFrequency);

// Game Update Logic
function update() {
  if (gameOver) return;

  bird.vy += gravity;
  bird.y += bird.vy;

  if (bird.y - birdHeight / 2 < 0 || bird.y + birdHeight / 2 > canvas.height) {
    endGame();
  }

  for (let i = pipes.length - 1; i >= 0; i--) {
    let pipe = pipes[i];
    pipe.x -= pipeSpeed;

    if (
      bird.x + birdWidth / 2 > pipe.x &&
      bird.x - birdWidth / 2 < pipe.x + pipeWidth
    ) {
      if (
        bird.y - birdHeight / 2 < pipe.topHeight ||
        bird.y + birdHeight / 2 > pipe.topHeight + gapHeight
      ) {
        endGame();
      }
    }

    if (!pipe.scored && pipe.x + pipeWidth < bird.x - birdWidth / 2) {
      score += 25;
      pipe.scored = true;
    }

    if (pipe.x + pipeWidth < 0) {
      pipes.splice(i, 1);
    }
  }

  stars.forEach(star => {
    star.x -= 0.5;
    if (star.x < 0) {
      star.x = canvas.width;
      star.y = Math.random() * canvas.height;
    }
  });

  if (countdown !== null) {
    countdownScale += 0.05;
    countdownOpacity -= 0.03;
    if (countdownOpacity < 0) countdownOpacity = 0;
  }
}

// Draw Everything
function draw() {
  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

  // Stars
  ctx.fillStyle = "white";
  stars.forEach(star => {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
    ctx.fill();
  });

  // Bird
  ctx.drawImage(birdImg, bird.x - birdWidth / 2, bird.y - birdHeight / 2, birdWidth, birdHeight);

  // Pipes
  for (let p of pipes) {
    let grad = ctx.createLinearGradient(p.x, 0, p.x + pipeWidth, 0);
    grad.addColorStop(0, "#a74ac7");
    grad.addColorStop(0.5, "#7d1b7e");
    grad.addColorStop(1, "#a74ac7");
    ctx.fillStyle = grad;
    ctx.shadowColor = "cyan";
    ctx.shadowBlur = 15;

    ctx.fillRect(p.x, 0, pipeWidth, p.topHeight);
    ctx.fillRect(p.x, p.topHeight + gapHeight, pipeWidth, canvas.height - (p.topHeight + gapHeight));
    ctx.shadowBlur = 0;
  }

  // Gravity Flip Countdown
  if (countdown !== null) {
    ctx.save();
    ctx.globalAlpha = countdownOpacity;
    ctx.fillStyle = "yellow";
    ctx.font = `${80 * countdownScale}px 'PressStart2P', monospace`;
    ctx.textAlign = "center";
    ctx.fillText(countdown, canvas.width / 2, canvas.height / 2);
    ctx.restore();
  }

  // Score
  ctx.fillStyle = "#00ff00";
  ctx.font = "bold 36px 'Courier New', monospace";
  ctx.textAlign = "right";
  ctx.textBaseline = "top";
  ctx.fillText(`SCORE: ${score}`, canvas.width - 20, 20);

  // Game Over UI
  if (gameOver) {
    ctx.fillStyle = "#ffffff";
    ctx.font = "20px 'PressStart2P', monospace";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("GAME OVER - PRESS SPACE TO RESTART", canvas.width / 2, canvas.height / 2 - 30);

    ctx.fillStyle = "#ff5555";
    ctx.font = "bold 26px 'Courier New', monospace";
    ctx.fillText(`FINAL SCORE: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}
gameLoop();

function endGame() {
  gameOver = true;
  countdown = null;
}

function restartGame() {
  bird.y = canvas.height / 2;
  bird.vy = 0;
  pipes = [];
  score = 0;
  gameOver = false;
  gravityDirection = 1;
  gravity = 0.4;
  countdown = null;
}

// Music autoplay fix
const bgMusic = document.getElementById('bgMusic');
bgMusic.volume = 0.5;

window.addEventListener('DOMContentLoaded', () => {
  bgMusic.muted = false;
  const playAttempt = bgMusic.play();
  if (playAttempt !== undefined) {
    playAttempt.catch(() => {
      // fallback
      const resumeMusic = () => {
        bgMusic.play();
        window.removeEventListener('click', resumeMusic);
        window.removeEventListener('keydown', resumeMusic);
      };
      window.addEventListener('click', resumeMusic);
      window.addEventListener('keydown', resumeMusic);
    });
  }
});
</script>
</body>
</html>

